=== RUN   TestMemoryEvolutionWithRuleChanges
    memory_evolution_test.go:21: ===== é˜¶æ®µ1ï¼šè§„åˆ™é—¨æ§›=100 =====
    memory_evolution_test.go:28: Task1: points=90, threshold=100, correct=true
    memory_evolution_test.go:38: 
        ===== é˜¶æ®µ2ï¼šè§„åˆ™å˜æ›´ä¸ºé—¨æ§›=120 =====
    memory_evolution_test.go:57: æ£€ç´¢åˆ°æ—§è®°å¿†: å½“ç”¨æˆ·ç§¯åˆ†ä½äº100æ—¶ï¼Œæ‹’ç»æŠ½å¥– (version=1, use_count=3)
    memory_evolution_test.go:62: Task2: points=110, threshold=120(æ–°è§„åˆ™), correct=true (æ—§è®°å¿†å¯¼è‡´åˆ¤é”™)
    memory_evolution_test.go:73: 
        ===== é˜¶æ®µ3ï¼šè§„åˆ™åˆå˜å›é—¨æ§›=100 =====
    memory_evolution_test.go:104: æ£€ç´¢åˆ°å¤šç‰ˆæœ¬è®°å¿†:
    memory_evolution_test.go:106:   - version=1, confidence=0.90, use_count=3: å½“ç”¨æˆ·ç§¯åˆ†ä½äº100æ—¶ï¼Œæ‹’ç»æŠ½å¥–
    memory_evolution_test.go:106:   - version=2, confidence=0.85, use_count=1: å½“ç”¨æˆ·ç§¯åˆ†ä½äº120æ—¶ï¼Œæ‹’ç»æŠ½å¥–ï¼ˆæ–°è§„åˆ™ï¼‰
    memory_evolution_test.go:112: Task3: points=105, threshold=100(å˜å›), correct=true
    memory_evolution_test.go:115: ä½¿ç”¨version=1çš„æ—§è®°å¿†ï¼Œåˆ¤æ–­æ­£ç¡®ï¼è¯´æ˜ç‰ˆæœ¬æ¼”åŒ–æœºåˆ¶æœ‰ä¸€å®šå®¹é”™èƒ½åŠ›
    memory_evolution_test.go:119: 
        ===== é˜¶æ®µ4ï¼šæ¨¡æ‹Ÿé¢‘ç¹å˜åŒ–å¯¼è‡´çš„è®°å¿†æ··ä¹± =====
    memory_evolution_test.go:159: è½®æ¬¡2: æ—§threshold=100, æ–°threshold=120, points=110, åˆ¤é”™! ç”Ÿæˆè®°å¿† version=2
    memory_evolution_test.go:159: è½®æ¬¡5: æ—§threshold=100, æ–°threshold=130, points=120, åˆ¤é”™! ç”Ÿæˆè®°å¿† version=5
    memory_evolution_test.go:164: 
        ç»è¿‡6æ¬¡è§„åˆ™å˜åŒ–ï¼Œç´¯ç§¯äº†2æ¡äº’ç›¸çŸ›ç›¾çš„è®°å¿†
    memory_evolution_test.go:166: è®°å¿†åˆ—è¡¨:
    memory_evolution_test.go:168:   - å½“ç”¨æˆ·ç§¯åˆ†ä½äº120æ—¶ï¼Œæ‹’ç»æŠ½å¥– (confidence=0.81, version=2)
    memory_evolution_test.go:168:   - å½“ç”¨æˆ·ç§¯åˆ†ä½äº130æ—¶ï¼Œæ‹’ç»æŠ½å¥– (confidence=0.84, version=5)
    memory_evolution_test.go:171: é—®é¢˜ï¼šå½“å‰ç³»ç»ŸåªæŒ‰ confidence + use_count æ’åºï¼Œæ— æ³•è¯†åˆ«å“ªæ¡æ˜¯'å½“å‰æœ‰æ•ˆ'çš„è§„åˆ™
    memory_evolution_test.go:172: è§£å†³æ–¹å‘ï¼šéœ€è¦å¼•å…¥æ—¶é—´ç»´åº¦ã€åºŸå¼ƒæœºåˆ¶ã€æˆ–åå‘é™æƒé€»è¾‘
    memory_evolution_test.go:431: 
        âœ… è®°å¿†æ¼”åŒ–æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: /Users/jiangyj/work/src/test/mem-test/outputs/memory_evolution_report_20251218_111200.json
--- PASS: TestMemoryEvolutionWithRuleChanges (0.00s)
=== RUN   TestMemoryRetrievalPriority
    memory_evolution_test.go:180: ===== æµ‹è¯•è®°å¿†æ£€ç´¢æ’åºé€»è¾‘ =====
    memory_evolution_test.go:213: æŒ‰å½“å‰è§„åˆ™æ’åº (confidence DESC, use_count DESC):
    memory_evolution_test.go:216:   1. ID=2, confidence=0.95, use_count=2, version=2: æ–°è§„åˆ™
    memory_evolution_test.go:216:   2. ID=1, confidence=0.90, use_count=10, version=1: æ—§è§„åˆ™
    memory_evolution_test.go:216:   3. ID=3, confidence=0.85, use_count=1, version=3: æœ€æ–°è§„åˆ™ï¼ˆå˜å›ï¼‰
    memory_evolution_test.go:220: 
        è§‚å¯Ÿï¼š
    memory_evolution_test.go:221: - æ–°è§„åˆ™(id=2)å› ä¸ºé«˜ç½®ä¿¡åº¦æ’ç¬¬ä¸€ âœ“
    memory_evolution_test.go:222: - ä½†å¦‚æœè§„åˆ™åˆå˜å›å»ï¼Œversion=3 åº”è¯¥ä¼˜å…ˆï¼Œç°åœ¨å´æ’æœ€å âœ—
    memory_evolution_test.go:223: - ç¼ºå°‘'æœ€è¿‘éªŒè¯æ­£ç¡®'çš„æ—¶é—´ç»´åº¦
--- PASS: TestMemoryRetrievalPriority (0.00s)
=== RUN   TestMemoryDeprecationScenario
    memory_evolution_test.go:228: ===== æ¨¡æ‹Ÿè®°å¿†åºŸå¼ƒåœºæ™¯ =====
    memory_evolution_test.go:240: åˆå§‹è®°å¿†: ç§¯åˆ†ä½äº100æ‹’ç» (confidence=0.90, use_count=5)
    memory_evolution_test.go:244: ä»»åŠ¡: points=105, ä½¿ç”¨è®°å¿†Aæ¨ç†...
    memory_evolution_test.go:263: 
        å½“å‰å®ç°çš„é—®é¢˜ï¼š
    memory_evolution_test.go:264: - Task.MemoryIDs è®°å½•äº†ä½¿ç”¨çš„è®°å¿†ID âœ“
    memory_evolution_test.go:265: - ä½†åˆ¤é”™åï¼Œä¸ä¼šåå‘è¿½è´£å¹¶é™æƒè¿™äº›è®°å¿† âœ—
    memory_evolution_test.go:266: - éœ€è¦åœ¨ CoachService.JudgeLotteryTask ä¹‹åï¼Œå¢åŠ é™æƒé€»è¾‘
--- PASS: TestMemoryDeprecationScenario (0.00s)
=== RUN   TestMemoryEvolution_Integration
2025/12/18 11:12:00 æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
    memory_integration_test.go:62: åˆ›å»ºæµ‹è¯• RunID: 3
    memory_integration_test.go:79: 
        ===== ç¬¬1è½®-é—¨æ§›100-ç§¯åˆ†90 =====
    memory_integration_test.go:91: ä»»åŠ¡æ‰§è¡Œå®Œæˆ: ID=610, Output={"allow": true, "reason": "ç”¨æˆ·ç§¯åˆ†ä¸º90åˆ†ï¼Œæ»¡è¶³æŠ½å¥–æ¡ä»¶"}
    memory_integration_test.go:100: åˆ¤é¢˜ç»“æœ: Type=incorrect, Content=åˆ¤æ–­é”™è¯¯ã€‚ç§¯åˆ†=90æ—¶ï¼Œé—¨æ§›=100ï¼Œåº”è¯¥: allow=falseï¼Œå®é™…è¾“å‡º: allow=true

2025/12/18 11:12:03 [31;1m/Users/jiangyj/work/src/test/mem-test/internal/service/reflection.go:76 [35;1mrecord not found
[0m[33m[2.313ms] [34;1m[rows:0][0m SELECT * FROM `memories` WHERE `trigger` LIKE '%ç§¯åˆ†ä¸è¶³%' AND run_id = 3 AND `memories`.`deleted_at` IS NULL ORDER BY version DESC,`memories`.`id` LIMIT 1
    memory_integration_test.go:111: ç”Ÿæˆè®°å¿†: ID=5, Trigger='ç§¯åˆ†ä¸è¶³', Lesson='éœ€è¦å…ˆæ£€æŸ¥ç”¨æˆ·ç§¯åˆ†æ˜¯å¦è¾¾åˆ°æŠ½å¥–é—¨æ§›', Version=1
    memory_integration_test.go:79: 
        ===== ç¬¬2è½®-é—¨æ§›120-ç§¯åˆ†110 =====
    memory_integration_test.go:91: ä»»åŠ¡æ‰§è¡Œå®Œæˆ: ID=611, Output={"allow": true, "reason": "ç”¨æˆ·ç§¯åˆ†ä¸º110ï¼Œæ»¡è¶³æŠ½å¥–é—¨æ§›è¦æ±‚"}
    memory_integration_test.go:100: åˆ¤é¢˜ç»“æœ: Type=incorrect, Content=åˆ¤æ–­é”™è¯¯ã€‚ç§¯åˆ†=110æ—¶ï¼Œé—¨æ§›=120ï¼Œåº”è¯¥: allow=falseï¼Œå®é™…è¾“å‡º: allow=true
    memory_integration_test.go:111: ç”Ÿæˆè®°å¿†: ID=6, Trigger='ç§¯åˆ†ä¸è¶³', Lesson='éœ€è¦å‡†ç¡®æ¯”è¾ƒç”¨æˆ·ç§¯åˆ†ä¸é—¨æ§›å€¼ï¼Œç§¯åˆ†å¿…é¡»å¤§äºç­‰äºé—¨æ§›æ‰èƒ½å…è®¸æ“ä½œ', Version=2
    memory_integration_test.go:79: 
        ===== ç¬¬3è½®-é—¨æ§›100-ç§¯åˆ†105 =====
    memory_integration_test.go:91: ä»»åŠ¡æ‰§è¡Œå®Œæˆ: ID=612, Output={"allow": true, "reason": "ç”¨æˆ·ç§¯åˆ†105åˆ†ï¼Œæ»¡è¶³æŠ½å¥–é—¨æ§›è¦æ±‚"}
    memory_integration_test.go:100: åˆ¤é¢˜ç»“æœ: Type=correct, Content=åˆ¤æ–­æ­£ç¡®
    memory_integration_test.go:192: 
        âœ… é›†æˆæµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: /Users/jiangyj/work/src/test/mem-test/outputs/memory_integration_test_20251218_111207.json
    memory_integration_test.go:119: 
        âœ… é›†æˆæµ‹è¯•å®Œæˆï¼Œç”Ÿæˆäº† 2 æ¡è®°å¿†
--- PASS: TestMemoryEvolution_Integration (7.09s)
PASS
ok  	mem-test/internal/service	7.510s
